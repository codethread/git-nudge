import{Q as _,t as A,v as O,w as Q,x as B,u as $,d as q,r as h,j as e,p as z,P as N,y as G,A as R,s as d,B as D,a as H,k as K,N as V,S as W,T as y,C as S}from"./index-C3bYPHRE.js";import{g as J,R as X}from"./gql-DUR5maw0.js";var Y=class extends _{constructor(t,a){super(t,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,a){super.setOptions({...t,behavior:A()},a)}getOptimisticResult(t){return t.behavior=A(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,a){var b,w;const{state:s}=t,r=super.createResult(t,a),{isFetching:n,isRefetching:o,isError:c,isRefetchError:i}=r,l=(w=(b=s.fetchMeta)==null?void 0:b.fetchMore)==null?void 0:w.direction,f=c&&l==="forward",g=n&&l==="forward",v=c&&l==="backward",u=n&&l==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Q(a,s.data),hasPreviousPage:O(a,s.data),isFetchNextPageError:f,isFetchingNextPage:g,isFetchPreviousPageError:v,isFetchingPreviousPage:u,isRefetchError:i&&!f&&!v,isRefetching:o&&!g&&!u}}};function Z(t,a){return B(t,Y)}const ee=J(`
	query GetUsers($cursor: String) {
		users(first: 100, after: $cursor) {
			count
			pageInfo {
				hasNextPage
				endCursor
			}
			nodes {
				id
				avatarUrl
				state
				name
				username
				bot
				webUrl
			}
		}
	}
`),te=()=>{const t=$(),a=Z({staleTime:q(1,"days"),refetchOnMount:!1,refetchOnWindowFocus:!1,queryKey:["usersAll"],initialPageParam:"",queryFn:({pageParam:s})=>t(ee,{cursor:s}),getNextPageParam:({users:s})=>{var r;return s!=null&&s.pageInfo.hasNextPage?(r=s==null?void 0:s.pageInfo)==null?void 0:r.endCursor:null}});return h.useEffect(()=>{a.hasNextPage&&a.fetchNextPage()},[a]),h.useMemo(()=>{var g,v;const{error:s,data:r,isFetching:n}=a,o=((v=(g=r==null?void 0:r.pages.at(0))==null?void 0:g.users)==null?void 0:v.count)??0,c=r==null?void 0:r.pages.map(u=>{var x,b;return((b=(x=u.users)==null?void 0:x.nodes)==null?void 0:b.length)??0}).reduce((u,x)=>u+x),i=(c?c/o:0)*100,l=i===100,f=r&&l?r.pages.flatMap(u=>{var x;return(x=u.users)==null?void 0:x.nodes}).filter(Boolean):[];return{error:s,progress:i,isFetching:n,allFetched:l,allUsers:f,refetch:a.refetch,users:f.filter(u=>!u.bot&&u.state==="active")}},[a])};var P="Avatar",[ae,me]=z(P),[se,k]=ae(P),C=h.forwardRef((t,a)=>{const{__scopeAvatar:s,...r}=t,[n,o]=h.useState("idle");return e.jsx(se,{scope:s,imageLoadingStatus:n,onImageLoadingStatusChange:o,children:e.jsx(N.span,{...r,ref:a})})});C.displayName=P;var F="AvatarImage",I=h.forwardRef((t,a)=>{const{__scopeAvatar:s,src:r,onLoadingStatusChange:n=()=>{},...o}=t,c=k(F,s),i=re(r,o.referrerPolicy),l=G(f=>{n(f),c.onImageLoadingStatusChange(f)});return R(()=>{i!=="idle"&&l(i)},[i,l]),i==="loaded"?e.jsx(N.img,{...o,ref:a,src:r}):null});I.displayName=F;var T="AvatarFallback",U=h.forwardRef((t,a)=>{const{__scopeAvatar:s,delayMs:r,...n}=t,o=k(T,s),[c,i]=h.useState(r===void 0);return h.useEffect(()=>{if(r!==void 0){const l=window.setTimeout(()=>i(!0),r);return()=>window.clearTimeout(l)}},[r]),c&&o.imageLoadingStatus!=="loaded"?e.jsx(N.span,{...n,ref:a}):null});U.displayName=T;function re(t,a){const[s,r]=h.useState("idle");return R(()=>{if(!t){r("error");return}let n=!0;const o=new window.Image,c=i=>()=>{n&&r(i)};return r("loading"),o.onload=c("loaded"),o.onerror=c("error"),o.src=t,a&&(o.referrerPolicy=a),()=>{n=!1}},[t,a]),s}var ne=C,oe=I,ie=U;function M({className:t,...a}){return e.jsx(ne,{"data-slot":"avatar",className:d("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...a})}function E({className:t,...a}){return e.jsx(oe,{"data-slot":"avatar-image",className:d("aspect-square size-full",t),...a})}function L({className:t,...a}){return e.jsx(ie,{"data-slot":"avatar-fallback",className:d("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}function ce({className:t,...a}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:d("w-full caption-bottom text-sm",t),...a})})}function le({className:t,...a}){return e.jsx("thead",{"data-slot":"table-header",className:d("[&_tr]:border-b",t),...a})}function de({className:t,...a}){return e.jsx("tbody",{"data-slot":"table-body",className:d("[&_tr:last-child]:border-0",t),...a})}function ue({className:t,...a}){return e.jsx("tfoot",{"data-slot":"table-footer",className:d("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",t),...a})}function j({className:t,...a}){return e.jsx("tr",{"data-slot":"table-row",className:d("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function p({className:t,...a}){return e.jsx("th",{"data-slot":"table-head",className:d("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function m({className:t,...a}){return e.jsx("td",{"data-slot":"table-cell",className:d("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function he({className:t,...a}){return e.jsx("caption",{"data-slot":"table-caption",className:d("text-muted-foreground mt-4 text-sm",t),...a})}function ge(t){var n;const a=H(o=>o.gitlab.domain),s=K(t).with({loading:!0},()=>{}).with({user:V.select()},o=>o).exhaustive(),r=(n=s==null?void 0:s.avatarUrl)==null?void 0:n.replace(/^\//,`https://${a}/`);return e.jsxs("div",{className:d("flex items-center space-x-4",t.className),children:[s!=null&&s.avatarUrl?e.jsxs(M,{className:"hover:outline-accent-foreground h-10 w-10 outline outline-offset-1 transition hover:outline-2",children:[e.jsx(E,{src:r}),e.jsx(L,{className:"text-xl",children:s.username.slice(0,2)})]}):e.jsx(W,{className:"h-10 w-10 rounded-full"}),s?e.jsxs("div",{children:[e.jsx(y,{flush:!0,children:s.name}),e.jsx("div",{className:"flex",children:e.jsxs(y,{flush:!0,children:[e.jsx("span",{className:"text-muted-foreground",children:s.state}),s.username===s.name?"":` ${s.username}`]})})]}):e.jsxs("div",{children:[e.jsx(S,{className:"w-[100px]"}),e.jsx(S,{className:"w-[100px]"})]})]})}function ve(){const{isFetching:t,error:a,allUsers:s,refetch:r}=te();return a?e.jsx("div",{children:a.message}):e.jsxs(ce,{children:[e.jsx(he,{children:"Users in this GitLab instance"}),e.jsx(le,{children:e.jsxs(j,{children:[e.jsx(p,{children:"Avatar"}),e.jsx(p,{className:"w-[100px]",children:"Name"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Username"})]})}),e.jsx(de,{children:s.map(n=>e.jsxs(j,{children:[e.jsx(m,{children:e.jsxs(M,{className:"h-6 w-6 outline outline-offset-1",children:[e.jsx(E,{src:n.avatarUrl}),e.jsx(L,{className:"text-xl",children:n.username.slice(0,2)})]})}),e.jsx(m,{className:"font-medium",children:e.jsx("a",{className:"text-blue-400 underline",href:n.webUrl,target:"_blank",rel:"noreferrer",children:n.name})}),e.jsx(m,{children:n.state}),e.jsx(m,{children:n.username})]},n.username))}),e.jsx(ue,{children:e.jsxs(j,{children:[e.jsx(m,{children:"Total"}),e.jsx(m,{children:e.jsx(D,{variant:"outline",size:"iconSm",onClick:()=>r(),children:e.jsx(X,{className:t?"animate-spin":""})})}),e.jsx(m,{className:"text-right",children:s.length})]})})]})}export{ge as U,ve as a,te as u};
