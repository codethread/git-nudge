import{Q as R,i as v,h as T,d as M,e as C,u as E,f as O,r as P,j as e,g as i,k as Q,z as S,N as A,S as B,T as w,l as y,B as I}from"./index-B3eOSWLS.js";import{g as q,A as U,a as k,b as F,R as $}from"./avatar-DjVQ7rhz.js";var _=class extends R{constructor(t,s){super(t,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,s){super.setOptions({...t,behavior:v()},s)}getOptimisticResult(t){return t.behavior=v(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,s){var g,N;const{state:a}=t,r=super.createResult(t,s),{isFetching:n,isRefetching:o,isError:u,isRefetchError:b}=r,h=(N=(g=a.fetchMeta)==null?void 0:g.fetchMore)==null?void 0:N.direction,x=u&&h==="forward",f=n&&h==="forward",m=u&&h==="backward",c=n&&h==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:M(s,a.data),hasPreviousPage:T(s,a.data),isFetchNextPageError:x,isFetchingNextPage:f,isFetchPreviousPageError:m,isFetchingPreviousPage:c,isRefetchError:b&&!x&&!m,isRefetching:o&&!f&&!c}}};function z(t,s){return C(t,_)}const D=q(`
	query GetUsers($cursor: String) {
		users(first: 100, after: $cursor) {
			count
			pageInfo {
				hasNextPage
				endCursor
			}
			nodes {
				id
				avatarUrl
				state
				name
				username
				bot
				webUrl
			}
		}
	}
`),G=()=>{const t=E(),s=z({staleTime:O(1,"days"),refetchOnMount:!1,refetchOnWindowFocus:!1,queryKey:["usersAll"],initialPageParam:"",queryFn:({pageParam:a})=>t(D,{cursor:a}),getNextPageParam:({users:a})=>{var r;return a!=null&&a.pageInfo.hasNextPage?(r=a==null?void 0:a.pageInfo)==null?void 0:r.endCursor:null}});return P.useEffect(()=>{s.hasNextPage&&s.fetchNextPage()},[s]),P.useMemo(()=>{var f,m;const{error:a,data:r,isFetching:n}=s,o=((m=(f=r==null?void 0:r.pages.at(0))==null?void 0:f.users)==null?void 0:m.count)??0,u=r==null?void 0:r.pages.map(c=>{var l,g;return((g=(l=c.users)==null?void 0:l.nodes)==null?void 0:g.length)??0}).reduce((c,l)=>c+l),b=(u?u/o:0)*100,h=b===100,x=r&&h?r.pages.flatMap(c=>{var l;return(l=c.users)==null?void 0:l.nodes}).filter(Boolean):[];return{error:a,progress:b,isFetching:n,allFetched:h,allUsers:x,refetch:s.refetch,users:x.filter(c=>!c.bot&&c.state==="active")}},[s])};function H({className:t,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:i("w-full caption-bottom text-sm",t),...s})})}function K({className:t,...s}){return e.jsx("thead",{"data-slot":"table-header",className:i("[&_tr]:border-b",t),...s})}function L({className:t,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:i("[&_tr:last-child]:border-0",t),...s})}function W({className:t,...s}){return e.jsx("tfoot",{"data-slot":"table-footer",className:i("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",t),...s})}function p({className:t,...s}){return e.jsx("tr",{"data-slot":"table-row",className:i("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function j({className:t,...s}){return e.jsx("th",{"data-slot":"table-head",className:i("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function d({className:t,...s}){return e.jsx("td",{"data-slot":"table-cell",className:i("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function J({className:t,...s}){return e.jsx("caption",{"data-slot":"table-caption",className:i("text-muted-foreground mt-4 text-sm",t),...s})}function Y(t){var n;const s=Q(o=>o.gitlab.domain),a=S(t).with({loading:!0},()=>{}).with({user:A.select()},o=>o).exhaustive(),r=(n=a==null?void 0:a.avatarUrl)==null?void 0:n.replace(/^\//,`https://${s}/`);return e.jsxs("div",{className:i("flex items-center space-x-4",t.className),children:[a!=null&&a.avatarUrl?e.jsxs(U,{className:"hover:outline-accent-foreground h-10 w-10 outline outline-offset-1 transition hover:outline-2",children:[e.jsx(k,{src:r}),e.jsx(F,{className:"text-xl",children:a.username.slice(0,2)})]}):e.jsx(B,{className:"h-10 w-10 rounded-full"}),a?e.jsxs("div",{children:[e.jsx(w,{flush:!0,children:a.name}),e.jsx("div",{className:"flex",children:e.jsxs(w,{flush:!0,children:[e.jsx("span",{className:"text-muted-foreground",children:a.state}),a.username===a.name?"":` ${a.username}`]})})]}):e.jsxs("div",{children:[e.jsx(y,{className:"w-[100px]"}),e.jsx(y,{className:"w-[100px]"})]})]})}function Z(){const{isFetching:t,error:s,allUsers:a,refetch:r}=G();return s?e.jsx("div",{children:s.message}):e.jsxs(H,{children:[e.jsx(J,{children:"Users in this GitLab instance"}),e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(j,{children:"Avatar"}),e.jsx(j,{className:"w-[100px]",children:"Name"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Username"})]})}),e.jsx(L,{children:a.map(n=>e.jsxs(p,{children:[e.jsx(d,{children:e.jsxs(U,{className:"h-6 w-6 outline outline-offset-1",children:[e.jsx(k,{src:n.avatarUrl}),e.jsx(F,{className:"text-xl",children:n.username.slice(0,2)})]})}),e.jsx(d,{className:"font-medium",children:e.jsx("a",{className:"text-blue-400 underline",href:n.webUrl,target:"_blank",rel:"noreferrer",children:n.name})}),e.jsx(d,{children:n.state}),e.jsx(d,{children:n.username})]},n.username))}),e.jsx(W,{children:e.jsxs(p,{children:[e.jsx(d,{children:"Total"}),e.jsx(d,{children:e.jsx(I,{variant:"outline",size:"iconSm",onClick:()=>r(),children:e.jsx($,{className:t?"animate-spin":""})})}),e.jsx(d,{className:"text-right",children:a.length})]})})]})}export{Y as U,Z as a,G as u};
