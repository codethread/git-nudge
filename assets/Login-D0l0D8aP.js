import{m as k,n as _,o as m,p as E,z as b,N as w,q as O,a as F,j as e,s as C,t as j,B as v,b as L,L as P}from"./index-Vwi4E7Qu.js";var x={exports:{}};const R={},S=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"})),y=k(S);var N;function q(){return N||(N=1,function(i,r){var o={},s=y,t=y.join;i.exports=r=function(a){var n=u();if(!a&&!n)return{};if(a=a||t(n,".netrc"),!a||!s.existsSync(a))return{};var c=s.readFileSync(a,"UTF-8");return r.parse(c)},r.parse=function(a){var n=a.split(`
`);for(var c in n){var l=n[c].indexOf("#");l>-1&&(n[c]=n[c].substring(0,l))}a=n.join(`
`);var d=a.split(/[ \t\n\r]+/),g={},h=null,f=null;d[0]===""&&d.shift();for(var l=0,f,p;l<d.length;l+=2)f=d[l],p=d[l+1],!(!f||!p)&&(f==="machine"?(h={},g[p]=h):h[f]=p);return g},r.format=function(n){var c=[],l=Object.getOwnPropertyNames(n).sort();return l.forEach(function(d){c.push("machine "+d);var g=n[d],h=Object.getOwnPropertyNames(g).sort();h.forEach(function(f){typeof g[f]=="string"&&c.push("    "+f+" "+g[f])})}),c.join(`
`)},r.save=function(n){var c=u(),l=t(c,".netrc"),d=r.format(n)+`
`;s.writeFileSync(l,d)};function u(){return o.HOME||o.HOMEPATH||o.USERPROFILE}}(x,x.exports)),x.exports}var z=q();const B=_(z),$=m.record(m.string(),m.object({login:m.string(),password:m.string()}),{message:"unable to parse Netrc"});function A(i){if(!i)return{tag:"missing"};let r=null;try{r=B.parse(i)}catch(u){console.error(u)}const{data:o,error:s}=$.safeParse(r);if(s)return{tag:"invalid",err:E(s).toString()};const t=Object.entries(o);return b(t).returnType().with([w.select()],([u,{login:a,password:n}])=>({tag:"valid",netrc:{domain:u,pass:n,user:a}})).otherwise(()=>({tag:"multiple",netrc:o}))}function D(){const{readNetrc:i}=O(),{data:r,isFetching:o,refetch:s}=F({queryKey:["netrc"],queryFn:async()=>{console.log("codethread","render netrc");const t=await i();return A(t)}});return!r||o?e.jsx(C,{}):(console.log("codethread","render login data"),b(r).with({tag:"valid"},({netrc:t})=>e.jsx(H,{netrc:t})).with({tag:"invalid",err:w.select()},t=>e.jsx("p",{children:t})).with({tag:"multiple"},({netrc:t})=>e.jsx(T,{netrc:t})).with({tag:"missing"},()=>e.jsx(M,{onRetry:s})).exhaustive())}const H=({netrc:i})=>{const{setLogin:r,setConfig:o}=j();return useEffect(()=>{console.log("codethread","update");const{pass:s,domain:t,user:u}=i;r({domain:t,token:s,user:u})},[i,r]),e.jsx(Redirect,{page:"welcome"})};function M({onRetry:i}){const{toggleFakeLab:r}=j(),o=L();return e.jsx("div",{className:"flex flex-1 justify-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(P,{className:"mb-lg",children:"Missing netrc"}),e.jsxs("div",{className:"gap-md flex flex-col",children:[e.jsxs("p",{children:["Could not load"," ",e.jsx("span",{className:"bg-secondary rounded-sm p-1",children:"~/.netrc"})," file. Please create one in the format:"]}),e.jsx("pre",{className:"bg-secondary p-sm rounded-sm text-wrap",children:["machine <domain> # e.g git.mycompany.io","login <gitlab username>","password <token>"].join(`
`)}),e.jsxs("p",{children:["Where ",e.jsx("span",{children:"<token>"})," is a gitlab access"," ",e.jsx("a",{href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",rel:"noreferrer",children:"token"})]}),e.jsx("div",{className:"flex justify-around",children:e.jsxs("div",{className:"gap-md flex",children:[e.jsx(v,{size:"lg",onClick:()=>i(),children:"Retry"}),e.jsx(v,{variant:"outline",size:"lg",onClick:()=>{r(),o({to:"/welcome"})},children:"Use FakeLab"})]})})]})]})})}function T({netrc:i}){const r=Object.entries(i),{setLogin:o}=j();return e.jsxs("div",{children:[e.jsx("p",{children:"You have multiple machine configs, which will you use for gitlab?"}),r.map(([s,{login:t,password:u}])=>e.jsx("div",{children:e.jsxs(v,{onClick:()=>{o({user:t,domain:s,token:u})},children:[s," ",t]})},s))]})}export{D as default};
