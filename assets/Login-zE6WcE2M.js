import{g as k,h as _,z as m,i as E,k as b,N as w,l as j,m as O,b as F,j as e,n as P,B as x,o as L,f as C}from"./index-R6EIVzsO.js";var v={exports:{}};const S={},R=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"})),y=k(R);var N;function q(){return N||(N=1,function(l,t){var a={},c=y,d=y.join;l.exports=t=function(r){var n=s();if(!r&&!n)return{};if(r=r||d(n,".netrc"),!r||!c.existsSync(r))return{};var i=c.readFileSync(r,"UTF-8");return t.parse(i)},t.parse=function(r){var n=r.split(`
`);for(var i in n){var o=n[i].indexOf("#");o>-1&&(n[i]=n[i].substring(0,o))}r=n.join(`
`);var u=r.split(/[ \t\n\r]+/),g={},h=null,f=null;u[0]===""&&u.shift();for(var o=0,f,p;o<u.length;o+=2)f=u[o],p=u[o+1],!(!f||!p)&&(f==="machine"?(h={},g[p]=h):h[f]=p);return g},t.format=function(n){var i=[],o=Object.getOwnPropertyNames(n).sort();return o.forEach(function(u){i.push("machine "+u);var g=n[u],h=Object.getOwnPropertyNames(g).sort();h.forEach(function(f){typeof g[f]=="string"&&i.push("    "+f+" "+g[f])})}),i.join(`
`)},t.save=function(n){var i=s(),o=d(i,".netrc"),u=t.format(n)+`
`;c.writeFileSync(o,u)};function s(){return a.HOME||a.HOMEPATH||a.USERPROFILE}}(v,v.exports)),v.exports}var z=q();const B=_(z),$=m.record(m.string(),m.object({login:m.string(),password:m.string()}),{message:"unable to parse Netrc"});function A(l){if(!l)return{tag:"missing"};let t=null;try{t=B.parse(l)}catch(s){console.error(s)}const{data:a,error:c}=$.safeParse(t);if(c)return{tag:"invalid",err:E(c).toString()};const d=Object.entries(a);return b(d).returnType().with([w.select()],([s,{login:r,password:n}])=>({tag:"valid",netrc:{domain:s,pass:n,user:r}})).otherwise(()=>({tag:"multiple",netrc:a}))}function U(){const{setLogin:l}=j(),{readNetrc:t}=O(),{data:a,isFetching:c,refetch:d}=F({queryKey:["netrc"],queryFn:async()=>{const s=await t(),r=A(s);if(r.tag==="valid"){const{netrc:{user:n,domain:i,pass:o}}=r;return l({domain:i,user:n,token:o}),new Promise(()=>{})}return r}});return!a||c?e.jsx(P,{}):b(a).with({tag:"invalid",err:w.select()},s=>e.jsx("p",{children:s})).with({tag:"multiple"},({netrc:s})=>e.jsx(M,{netrc:s})).with({tag:"missing"},()=>e.jsx(H,{onRetry:d})).exhaustive()}function H({onRetry:l}){const{toggleFakeLab:t}=j(),{nav:a}=L();return e.jsx("div",{className:"flex flex-1 justify-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(C,{className:"mb-lg",children:"Missing netrc"}),e.jsxs("div",{className:"gap-md flex flex-col",children:[e.jsxs("p",{children:["Could not load"," ",e.jsx("span",{className:"bg-secondary rounded-sm p-1",children:"~/.netrc"})," file. Please create one in the format:"]}),e.jsx("pre",{className:"bg-secondary p-sm rounded-sm text-wrap",children:["machine <domain> # e.g git.mycompany.io","login <gitlab username>","password <token>"].join(`
`)}),e.jsxs("p",{children:["Where ",e.jsx("span",{children:"<token>"})," is a gitlab access"," ",e.jsx("a",{href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",rel:"noreferrer",children:"token"})]}),e.jsx("div",{className:"flex justify-around",children:e.jsxs("div",{className:"gap-md flex",children:[e.jsx(x,{size:"lg",onClick:()=>l(),children:"Retry"}),e.jsx(x,{variant:"outline",size:"lg",onClick:()=>{t(),a("welcome")},children:"Use FakeLab"})]})})]})]})})}function M({netrc:l}){const t=Object.entries(l),{setLogin:a}=j();return e.jsxs("div",{children:[e.jsx("p",{children:"You have multiple machine configs, which will you use for gitlab?"}),t.map(([c,{login:d,password:s}])=>e.jsx("div",{children:e.jsxs(x,{onClick:()=>{a({user:d,domain:c,token:s})},children:[c," ",d]})},c))]})}export{U as default};
