import{g as k,f as E,k as h,l as _,z as b,N as w,m as O,j as e,n as C,o as j,r as F,p as L,B as v,u as P,L as S}from"./index-Blh_3CCp.js";import{u as z}from"./useQuery-CJtX6N2R.js";var x={exports:{}};const R={},q=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"})),y=k(q);var N;function B(){return N||(N=1,function(i,r){var s={},a=y,c=y.join;i.exports=r=function(o){var n=t();if(!o&&!n)return{};if(o=o||c(n,".netrc"),!o||!a.existsSync(o))return{};var l=a.readFileSync(o,"UTF-8");return r.parse(l)},r.parse=function(o){var n=o.split(`
`);for(var l in n){var u=n[l].indexOf("#");u>-1&&(n[l]=n[l].substring(0,u))}o=n.join(`
`);var d=o.split(/[ \t\n\r]+/),g={},m=null,f=null;d[0]===""&&d.shift();for(var u=0,f,p;u<d.length;u+=2)f=d[u],p=d[u+1],!(!f||!p)&&(f==="machine"?(m={},g[p]=m):m[f]=p);return g},r.format=function(n){var l=[],u=Object.getOwnPropertyNames(n).sort();return u.forEach(function(d){l.push("machine "+d);var g=n[d],m=Object.getOwnPropertyNames(g).sort();m.forEach(function(f){typeof g[f]=="string"&&l.push("    "+f+" "+g[f])})}),l.join(`
`)},r.save=function(n){var l=t(),u=c(l,".netrc"),d=r.format(n)+`
`;a.writeFileSync(u,d)};function t(){return s.HOME||s.HOMEPATH||s.USERPROFILE}}(x,x.exports)),x.exports}var $=B();const A=E($),H=h.record(h.string(),h.object({login:h.string(),password:h.string()}),{message:"unable to parse Netrc"});function M(i){if(!i)return{tag:"missing"};let r=null;try{r=A.parse(i)}catch(t){console.error(t)}const{data:s,error:a}=H.safeParse(r);if(a)return{tag:"invalid",err:_(a).toString()};const c=Object.entries(s);return b(c).returnType().with([w.select()],([t,{login:o,password:n}])=>({tag:"valid",netrc:{domain:t,pass:n,user:o}})).otherwise(()=>({tag:"multiple",netrc:s}))}const T=({netrc:i})=>{const{setLogin:r,setConfig:s}=j();return F.useEffect(()=>{console.log("codethread","update");const{pass:a,domain:c,user:t}=i;r({domain:c,token:a,user:t})},[i,r]),e.jsx(L,{to:"/welcome"})};function U({onRetry:i}){const{toggleFakeLab:r}=j(),s=P();return e.jsx("div",{className:"flex flex-1 justify-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(S,{className:"mb-lg",children:"Missing netrc"}),e.jsxs("div",{className:"gap-md flex flex-col",children:[e.jsxs("p",{children:["Could not load"," ",e.jsx("span",{className:"bg-secondary rounded-sm p-1",children:"~/.netrc"})," file. Please create one in the format:"]}),e.jsx("pre",{className:"bg-secondary p-sm rounded-sm text-wrap",children:["machine <domain> # e.g git.mycompany.io","login <gitlab username>","password <token>"].join(`
`)}),e.jsxs("p",{children:["Where ",e.jsx("span",{children:"<token>"})," is a gitlab access"," ",e.jsx("a",{href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",rel:"noreferrer",children:"token"})]}),e.jsx("div",{className:"flex justify-around",children:e.jsxs("div",{className:"gap-md flex",children:[e.jsx(v,{size:"lg",onClick:()=>i(),children:"Retry"}),e.jsx(v,{variant:"outline",size:"lg",onClick:()=>{r(),s({to:"/welcome"})},children:"Use FakeLab"})]})})]})]})})}function D({netrc:i}){const r=Object.entries(i),{setLogin:s}=j();return e.jsxs("div",{children:[e.jsx("p",{children:"You have multiple machine configs, which will you use for gitlab?"}),r.map(([a,{login:c,password:t}])=>e.jsx("div",{children:e.jsxs(v,{onClick:()=>{s({user:c,domain:a,token:t})},children:[a," ",c]})},a))]})}const Q=function(){const{readNetrc:r}=O(),{data:s,isFetching:a,refetch:c}=z({queryKey:["netrc"],queryFn:async()=>{console.log("codethread","render netrc");const t=await r();return M(t)}});return!s||a?e.jsx(C,{}):(console.log("codethread","render login data"),b(s).with({tag:"valid"},({netrc:t})=>e.jsx(T,{netrc:t})).with({tag:"invalid",err:w.select()},t=>e.jsx("p",{children:t})).with({tag:"multiple"},({netrc:t})=>e.jsx(D,{netrc:t})).with({tag:"missing"},()=>e.jsx(U,{onRetry:c})).exhaustive())};export{Q as component};
